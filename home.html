<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#06011c" />
  <title>Mi Perfil - VirtualGift</title>

  <!-- âœ… Android App Mode -->
  <script defer src="js/app-mode.js"></script>

  <!-- Google Fonts â€” Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,400;0,14..32,500;0,14..32,600;0,14..32,700;0,14..32,800;0,14..32,900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="css/profile.css">
  <link rel="stylesheet" href="css/header.css"> <!-- âœ… Header compartido -->

  <!-- Firebase -->
  <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <script defer src="js/firebase-config.js"></script>

  <script>
    function withAppFlag(url) {
      const isAndroidApp =
        document.documentElement.classList.contains("android-app") ||
        document.body.classList.contains("android-app");
      if (!isAndroidApp) return url;
      if (url.includes("app=android")) return url;
      const parts = url.split('#');
      const base = parts[0];
      const hash = parts[1] ? ('#' + parts[1]) : '';
      const fixed = base.includes("?") ? (base + "&app=android") : (base + "?app=android");
      return fixed + hash;
    }
  </script>
</head>

<body>

  <!-- âœ… HEADER -->
  <header class="header">
    <div class="logo">
      <img src="images/logo-virtual-login.png" alt="VirtualGift Logo" class="logo-image" />
      <span class="logo-text">VIRTUAL<span class="logo-studios">GIFT</span></span>
    </div>

    <div class="header-icons">
      <div class="icon-users" onclick="window.location.href=withAppFlag('home.html')" style="cursor:pointer;">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
      </div>

      <div class="icon-coin" onclick="window.location.href=withAppFlag('puntos.html')" style="cursor:pointer;">
        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <circle cx="50" cy="50" r="48" fill="#FDB813"/>
          <defs>
            <radialGradient id="coinGradient">
              <stop offset="0%"   style="stop-color:#FFD700;stop-opacity:1"/>
              <stop offset="100%" style="stop-color:#FFA500;stop-opacity:1"/>
            </radialGradient>
          </defs>
          <circle cx="50" cy="50" r="42" fill="url(#coinGradient)"/>
          <path d="M 30 30 L 42 65 L 50 65 L 58 65 L 70 30 L 62 30 L 54 57 L 50 57 L 46 57 L 38 30 Z" fill="#FFFACD"/>
        </svg>
      </div>

      <div class="icon-notification" onclick="window.location.href=withAppFlag('notificaciones.html')" style="cursor:pointer;">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
        </svg>
        <span class="notification-badge" id="badgeCount" style="display:none;">0</span>
      </div>
    </div>
  </header>

  <!-- ESTADO DE CARGA -->
  <div id="loading" class="loading">
    <div class="spinner"></div>
    <p>Cargando perfil...</p>
  </div>

  <!-- ESTADO DE ERROR -->
  <div id="error" class="error-state">
    <div class="error-icon">âš ï¸</div>
    <div class="error-message">
      <p>No se pudo cargar tu perfil</p>
      <p style="font-size: 0.9em; margin-top: 6px;">Verifica tu conexiÃ³n e intenta de nuevo</p>
    </div>
    <button class="btn btn-primary" onclick="location.reload()">ğŸ”„ Reintentar</button>
    <button class="btn" onclick="window.location.href=withAppFlag('inicio.html')" style="margin-top: 10px;">
      â† Volver al inicio
    </button>
  </div>

  <!-- CONTENIDO PRINCIPAL -->
  <!-- âœ… page-content para compensar el header fijo -->
  <div id="content" class="container page-content" style="display:none;">

    <!-- Barra superior -->
    <div class="top-bar">
      <button class="back-btn" onclick="window.location.href=withAppFlag('inicio.html')">
        â† Volver al inicio
      </button>
    </div>

    <!-- TARJETA DE PERFIL -->
    <div class="profile-card">
      <div class="profile-row">
        <div class="avatar-wrap">
          <img id="avatar" class="avatar" src="images/logo-virtual-login.png" alt="Avatar" />
          <button id="btnEditAvatar" class="edit-avatar-btn" title="Cambiar avatar" aria-label="Cambiar avatar">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 20H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L8 18l-4 1 1-4L16.5 3.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>

        <div class="profile-meta">
          <div class="user-name" id="userName">Usuario</div>
          <div class="email-row">
            <div class="user-email" id="userEmail" title="Correo electrÃ³nico"></div>
            <button id="btnToggleEmail" class="icon-btn" title="Mostrar/Ocultar correo" aria-label="Mostrar u ocultar correo">
              <svg id="eyeOpen" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <svg id="eyeClosed" style="display:none;" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a21.88 21.88 0 0 1 5.06-6.94" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M1 1l22 22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9.9 4.24A10.94 10.94 0 0 1 12 4c7 0 11 8 11 8a21.87 21.87 0 0 1-2.98 4.33" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M14.12 14.12a3 3 0 0 1-4.24-4.24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div class="hint">
        <span class="chip" id="chipProvider">ğŸ” Cuenta segura</span>
        <span class="chip">âš¡ Perfil sincronizado</span>
      </div>
    </div>

    <!-- SECCIÃ“N DE ACCIONES -->
    <div class="section">
      <h2 class="section-title">âš¡ Acciones</h2>
      <div class="action-buttons">
        <button class="btn" id="btnEditName">âœï¸ Cambiar nombre</button>
        <button class="btn btn-warning" id="btnResetPassword">ğŸ”‘ Cambiar contraseÃ±a</button>
        <button class="btn btn-danger" id="btnLogout">ğŸšª Cerrar SesiÃ³n</button>
      </div>
    </div>

    <!-- SECCIÃ“N DE SOPORTE -->
    <div class="section" style="margin-top: 14px;">
      <h2 class="section-title">ğŸ›Ÿ Soporte</h2>
      <div class="action-buttons">
        <button class="btn" id="btnReport">ğŸ› Reportar un problema</button>
        <button class="btn btn-ghost-danger" id="btnDeleteAccount">Eliminar mi cuenta</button>
      </div>
    </div>

  </div>

  <div id="toast" class="toast"></div>
  <input id="avatarInput" type="file" accept="image/*" style="display:none;" />

  <script defer src="js/profile.js"></script>
</body>
</html>
