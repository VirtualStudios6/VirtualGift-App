<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#06011c">
    <link rel="icon" type="image/png" href="images/logo-virtual-login.png">
    <title>VirtualGift</title>

    <link rel="stylesheet" href="css/inicio.css">
    <script defer src="js/app-mode.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script defer src="js/firebase-config.js"></script>

    <script>
        function withAppFlag(url) {
            const isAndroidApp =
                document.documentElement.classList.contains("android-app") ||
                document.body.classList.contains("android-app");
            if (!isAndroidApp) return url;
            if (url.includes("app=android")) return url;
            const parts = url.split('#');
            const base = parts[0];
            const hash = parts[1] ? ('#' + parts[1]) : '';
            const fixed = base.includes("?") ? (base + "&app=android") : (base + "?app=android");
            return fixed + hash;
        }
    </script>

    <style>
        /* ===== FORTNITE SHOP HEADER SECTION ===== */
        .fn-shop-section {
            padding: 16px 16px 0;
        }

        .fn-shop-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 10px;
            gap: 10px;
        }

        .fn-shop-left {}

        .fn-shop-title {
            font-size: 22px;
            font-weight: 900;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
            line-height: 1;
        }

        .fn-live-badge {
            background: #ef4444;
            color: white;
            font-size: 10px;
            font-weight: 800;
            padding: 3px 8px;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            letter-spacing: 0.3px;
            animation: livePulse 2s infinite;
        }
        .fn-live-badge::before {
            content: '';
            width: 5px; height: 5px;
            border-radius: 50%;
            background: white;
            animation: pulse 1.5s infinite;
        }
        @keyframes livePulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0.4); }
            50% { box-shadow: 0 0 0 6px rgba(239,68,68,0); }
        }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

        .fn-countdown-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 5px;
        }
        .fn-countdown-label {
            font-size: 13px;
            color: #9ca3af;
            font-weight: 600;
        }
        .fn-countdown-timer {
            font-size: 18px;
            font-weight: 800;
            color: #00d4ff;
            font-variant-numeric: tabular-nums;
            letter-spacing: 2px;
        }

        /* Bot√≥n cosm√©ticos */
        .fn-cosmetics-btn {
            display: flex;
            align-items: center;
            gap: 7px;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 30px;
            padding: 9px 16px;
            color: white;
            text-decoration: none;
            font-size: 13px;
            font-weight: 700;
            white-space: nowrap;
            flex-shrink: 0;
            transition: background 0.2s;
            cursor: pointer;
        }
        .fn-cosmetics-btn:hover { background: rgba(255,255,255,0.12); }
        .fn-cosmetics-btn svg { width: 16px; height: 16px; fill: white; flex-shrink: 0; }

        /* SHOP PREVIEW STRIP */
        .fn-shop-strip {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 10px 16px 16px;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }
        .fn-shop-strip::-webkit-scrollbar { display: none; }

        /* "Ver Tienda" card ‚Äî primera del strip */
        .fn-view-shop-card {
            flex-shrink: 0;
            width: 120px;
            height: 180px;
            border-radius: 14px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            border: 2px solid rgba(0, 212, 255, 0.5);
            background: #0a0a1a;
            text-decoration: none;
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
        }
        .fn-view-shop-card:active { transform: scale(0.95); }

        .fn-view-shop-inner {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px;
            background: linear-gradient(160deg, #0a1535 0%, #050d20 100%);
        }
        .fn-view-shop-icon {
            font-size: 28px;
        }
        .fn-view-shop-text {
            font-size: 15px;
            font-weight: 900;
            color: white;
            text-align: center;
            line-height: 1.2;
            letter-spacing: 0.3px;
        }
        .fn-view-shop-sub {
            font-size: 10px;
            color: #00d4ff;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 3px;
        }
        .fn-view-shop-sub::after {
            content: '‚Üí';
            font-size: 12px;
        }

        /* Preview items en el strip */
        .fn-strip-item {
            flex-shrink: 0;
            width: 120px;
            height: 180px;
            border-radius: 14px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255,255,255,0.07);
            cursor: pointer;
            transition: transform 0.2s;
        }
        .fn-strip-item:active { transform: scale(0.95); }
        .fn-strip-item img {
            width: 100%; height: 100%;
            object-fit: cover;
            object-position: top center;
        }
        .fn-strip-item-info {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            padding: 6px 8px 7px;
            background: linear-gradient(0deg, rgba(0,0,0,0.85) 0%, transparent 100%);
        }
        .fn-strip-item-name {
            font-size: 10px;
            font-weight: 700;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .fn-strip-item-price {
            display: flex;
            align-items: center;
            gap: 3px;
            margin-top: 2px;
        }
        .fn-strip-item-price img { width: 10px; height: 10px; object-fit: contain; }
        .fn-strip-item-price span { font-size: 10px; font-weight: 700; color: #7ec8e3; }

        /* Skeleton para el strip */
        .fn-strip-skeleton {
            flex-shrink: 0;
            width: 120px;
            height: 180px;
            border-radius: 14px;
            background: linear-gradient(90deg,
                rgba(255,255,255,0.04) 25%,
                rgba(255,255,255,0.08) 50%,
                rgba(255,255,255,0.04) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>

<body>
    <!-- HEADER -->
    <header class="header">
        <div class="logo">
            <img src="images/logo-virtual-login.png" alt="VirtualGift" class="logo-image">
            <span class="logo-text">VIRTUAL<span class="logo-studios">GIFT</span></span>
        </div>
        <div class="header-icons">
            <div class="icon-users" onclick="window.location.href=withAppFlag('home.html')" style="cursor:pointer;">
                <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            </div>
            <div class="icon-coin" onclick="window.location.href=withAppFlag('puntos.html')" style="cursor:pointer;">
                <svg viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="48" fill="#FDB813"/>
                    <defs><radialGradient id="cg"><stop offset="0%" style="stop-color:#FFD700"/><stop offset="100%" style="stop-color:#FFA500"/></radialGradient></defs>
                    <circle cx="50" cy="50" r="42" fill="url(#cg)"/>
                    <path d="M 30 30 L 42 65 L 50 65 L 58 65 L 70 30 L 62 30 L 54 57 L 50 57 L 46 57 L 38 30 Z" fill="#FFFACD"/>
                </svg>
            </div>
            <div class="icon-notification" onclick="window.location.href=withAppFlag('notificaciones.html')" style="cursor:pointer;">
                <svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>
                <span class="notification-badge" id="notificationBadge">0</span>
            </div>
        </div>
    </header>

    <!-- GAMING NEWS -->
    <section class="section" id="news">
        <div class="section-header">
            <h2 class="section-title">Gaming News üì°</h2>
            <a href="#" class="section-link">Noticias</a>
        </div>
        <div class="news-grid" id="newsGrid">
            <div class="news-card skeleton-news"><div class="news-image"></div><p class="news-label"></p></div>
            <div class="news-card skeleton-news"><div class="news-image"></div><p class="news-label"></p></div>
            <div class="news-card skeleton-news"><div class="news-image"></div><p class="news-label"></p></div>
        </div>
        <p id="newsError" style="display:none; color:#ef4444; margin-top:10px;">Error cargando noticias.</p>
    </section>

    <!-- TOP SORTEOS -->
    <section class="section" id="sorteos">
        <div class="section-header">
            <h2 class="section-title">Top Sorteos üèÜ</h2>
            <a href="#" class="section-link">Ver todo</a>
        </div>
        <div class="carousel-container">
            <div class="carousel-wrapper">
                <div class="carousel-slide"><img src="images/banner-sorteos/1.png" alt="Sorteo 1"></div>
                <div class="carousel-slide"><img src="images/banner-sorteos/2.png" alt="Sorteo 2"></div>
                <div class="carousel-slide"><img src="images/banner-sorteos/3.png" alt="Sorteo 3"></div>
            </div>
            <div class="carousel-dots">
                <span class="carousel-dot active" data-index="0"></span>
                <span class="carousel-dot" data-index="1"></span>
                <span class="carousel-dot" data-index="2"></span>
            </div>
        </div>
    </section>

    <!-- FORTNITE SHOP SECTION -->
    <section class="fn-shop-section">
        <div class="fn-shop-header">
            <div class="fn-shop-left">
                <div class="fn-shop-title">
                    Fortnite Shop
                    <span class="fn-live-badge">LIVE</span>
                </div>
                <div class="fn-countdown-row">
                    <span class="fn-countdown-label">Nueva Tienda en:</span>
                    <span class="fn-countdown-timer" id="fnCountdown">--:--:--</span>
                </div>
            </div>
            <a href="tienda.html"
               onclick="this.href=withAppFlag('tienda.html')"
               class="fn-cosmetics-btn">
                <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                Cosm√©ticos
            </a>
        </div>
    </section>

    <!-- STRIP DE PREVIEW DE LA TIENDA -->
    <div class="fn-shop-strip" id="fnShopStrip">
        <a href="tienda.html"
           onclick="this.href=withAppFlag('tienda.html')"
           class="fn-view-shop-card">
            <div class="fn-view-shop-inner">
                <div class="fn-view-shop-icon">üõí</div>
                <div class="fn-view-shop-text">Ver<br>Tienda</div>
                <div class="fn-view-shop-sub">Ver todo</div>
            </div>
        </a>
        <div class="fn-strip-skeleton"></div>
        <div class="fn-strip-skeleton"></div>
        <div class="fn-strip-skeleton"></div>
        <div class="fn-strip-skeleton"></div>
        <div class="fn-strip-skeleton"></div>
    </div>

    <!-- OFERTAS -->
    <section class="section" id="ofertas">
        <div class="section-header">
            <h2 class="section-title">Ofertas üéØ</h2>
            <a href="ofertas.html" class="section-link" onclick="this.href=withAppFlag('ofertas.html')">Ver todo</a>
        </div>
        <p class="section-subtitle">Gana VirtualCoins completando ofertas</p>
        <div class="skins-grid">
            <div class="skin-card" onclick="window.location.href=withAppFlag('ofertas.html')" style="cursor:pointer;">
                <div class="skin-badge">üß© OFERTAS</div>
                <div class="skin-image"><img src="images/ofertas/1.png" alt="Ofertas" onerror="this.style.display='none'"></div>
                <p class="skin-name">Ofertas de Juegos</p>
            </div>
            <div class="skin-card" onclick="window.location.href=withAppFlag('ofertas.html')" style="cursor:pointer;">
                <div class="skin-badge">üìù ENCUESTAS</div>
                <div class="skin-image"><img src="images/ofertas/2.png" alt="Encuestas" onerror="this.style.display='none'"></div>
                <p class="skin-name">Encuestas</p>
            </div>
            <div class="skin-card" onclick="window.location.href=withAppFlag('ofertas.html')" style="cursor:pointer;">
                <div class="skin-badge">üí∏ BONUS</div>
                <div class="skin-image"><img src="images/ofertas/3.png" alt="Bonus" onerror="this.style.display='none'"></div>
                <p class="skin-name">Mejores Pagos</p>
            </div>
            <div class="skin-card" onclick="window.location.href=withAppFlag('ofertas.html')" style="cursor:pointer;">
                <div class="skin-badge">üî• TOP</div>
                <div class="skin-image"><img src="images/ofertas/4.png" alt="Top" onerror="this.style.display='none'"></div>
                <p class="skin-name">Top Ofertas</p>
            </div>
        </div>
    </section>

    <!-- POPULAR -->
    <section class="section">
        <div class="section-header">
            <h2 class="section-title">Popular</h2>
            <a href="#" class="section-link">Ver ahora</a>
        </div>
        <div class="popular-banner"></div>
    </section>

    <!-- POPULAR GAMES -->
    <section class="section" id="games">
        <div class="section-header">
            <h2 class="section-title">Popular Games</h2>
            <a href="#" class="section-link">Ver ahora</a>
        </div>
        <div class="games-grid">
            <div class="game-card">
                <div class="playing-badge">üî¥ PLAYING</div>
                <div class="game-image"></div>
                <p class="game-name">Color Challenge</p>
                <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
            </div>
            <div class="game-card">
                <div class="playing-badge">üî¥ PLAYING</div>
                <div class="game-image"></div>
                <p class="game-name">Fill The Gap</p>
                <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
            </div>
            <div class="game-card">
                <div class="playing-badge">üîµ PLAYING</div>
                <div class="game-image"></div>
                <p class="game-name">BOTTLE FLIP</p>
                <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
            </div>
        </div>
    </section>

    <script defer src="js/carousel.js"></script>
    <script defer src="js/news-feed.js"></script>
    <script defer src="js/inicio.js"></script>

    <script>
    // ===== COUNTDOWN =====
    function updateFnCountdown() {
        const now = new Date();
        const utcMs = now.getTime() + now.getTimezoneOffset() * 60000;
        const rdNow = new Date(utcMs - 4 * 3600000);
        let reset = new Date(rdNow);
        reset.setHours(20, 0, 0, 0);
        if (rdNow >= reset) reset.setDate(reset.getDate() + 1);
        const diff = reset - rdNow;
        const h = Math.floor(diff / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        const s = Math.floor((diff % 60000) / 1000);
        const el = document.getElementById('fnCountdown');
        if (el) el.textContent =
            `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    }
    setInterval(updateFnCountdown, 1000);
    updateFnCountdown();

    // ===== SHOP STRIP CON ROTACI√ìN =====
    const RARITY_BG_STRIP = {
        "poco com√∫n":  "linear-gradient(160deg,#818181,#3a3a3a)",
        "poco comun":  "linear-gradient(160deg,#818181,#3a3a3a)",
        "com√∫n":       "linear-gradient(160deg,#818181,#3a3a3a)",
        "comun":       "linear-gradient(160deg,#818181,#3a3a3a)",
        "common":      "linear-gradient(160deg,#818181,#3a3a3a)",
        "infrecuente": "linear-gradient(160deg,#60a32e,#2a4d10)",
        "uncommon":    "linear-gradient(160deg,#60a32e,#2a4d10)",
        "raro":        "linear-gradient(160deg,#4f6fa8,#1f3a6a)",
        "rare":        "linear-gradient(160deg,#4f6fa8,#1f3a6a)",
        "√©pico":       "linear-gradient(160deg,#8b38cc,#4a1575)",
        "epico":       "linear-gradient(160deg,#8b38cc,#4a1575)",
        "epic":        "linear-gradient(160deg,#8b38cc,#4a1575)",
        "legendario":  "linear-gradient(160deg,#e8a224,#7a4d08)",
        "legendary":   "linear-gradient(160deg,#e8a224,#7a4d08)",
        "m√≠tico":      "linear-gradient(160deg,#f0e13c,#7a6e0a)",
        "mitico":      "linear-gradient(160deg,#f0e13c,#7a6e0a)",
        "mythic":      "linear-gradient(160deg,#f0e13c,#7a6e0a)",
        "serie icon":  "linear-gradient(160deg,#21c9c3,#0a5a57)",
        "icon":        "linear-gradient(160deg,#21c9c3,#0a5a57)",
        "serie marvel":"linear-gradient(160deg,#c1282d,#5a0a0d)",
        "marvel":      "linear-gradient(160deg,#c1282d,#5a0a0d)",
    };

    function getStripBg(rarity) {
        const key = String(rarity || "").toLowerCase().trim();
        for (const [k, v] of Object.entries(RARITY_BG_STRIP)) {
            if (key.includes(k)) return v;
        }
        return "linear-gradient(160deg,#1a1a2e,#0d0d1a)";
    }

    function buildStripCard(item) {
        const name = String(item.name || "").replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
        const bg = getStripBg(item.rarity);
        const price = item.price || 0;
        const card = document.createElement('a');
        card.href = withAppFlag('tienda.html');
        card.className = 'fn-strip-item';
        card.style.background = bg;
        card.innerHTML = `
            <img src="${item.imageUrl}" alt="${name}" loading="lazy" onerror="this.style.display='none'">
            <div class="fn-strip-item-info">
                <div class="fn-strip-item-name">${name}</div>
                ${price ? `<div class="fn-strip-item-price">
                    <img src="https://fortnite-api.com/images/vbuck.png" onerror="this.style.display='none'">
                    <span>${price}</span>
                </div>` : ''}
            </div>`;
        return card;
    }

    let _allStripItems = [];
    let _stripOffset = 0;
    let _stripRotationTimer = null;
    const STRIP_VISIBLE = 18;
    const STRIP_ROTATE_MS = 23000;

    function renderStripPage() {
        const strip = document.getElementById('fnShopStrip');
        if (!strip || !_allStripItems.length) return;

        const viewCard = strip.querySelector('.fn-view-shop-card');
        strip.innerHTML = '';
        if (viewCard) strip.appendChild(viewCard);

        const total = _allStripItems.length;
        for (let i = 0; i < STRIP_VISIBLE; i++) {
            const item = _allStripItems[(_stripOffset + i) % total];
            if (item && item.imageUrl) {
                strip.appendChild(buildStripCard(item));
            }
        }

        _stripOffset = (_stripOffset + STRIP_VISIBLE) % total;
    }

    function startStripRotation() {
        if (_stripRotationTimer) clearInterval(_stripRotationTimer);
        renderStripPage();
        _stripRotationTimer = setInterval(renderStripPage, STRIP_ROTATE_MS);
    }

    function loadShopStrip() {
        const strip = document.getElementById('fnShopStrip');
        if (!strip || !window.db) return;

        window.db.collection("shopDailyItems")
            .orderBy("sort", "asc")
            .onSnapshot(snap => {
                _allStripItems = [];
                snap.forEach(doc => {
                    const item = { id: doc.id, ...doc.data() };
                    if (item.imageUrl) _allStripItems.push(item);
                });
                _stripOffset = Math.floor(Math.random() * _allStripItems.length);
                startStripRotation();
            }, err => {
                console.error("ShopStrip error:", err);
            });
    }

    function waitDbStrip(max = 80) {
        let i = 0;
        const t = setInterval(() => {
            i++;
            if (window.db) { clearInterval(t); loadShopStrip(); }
            else if (i >= max) clearInterval(t);
        }, 100);
    }

    window.addEventListener('load', () => waitDbStrip());
    </script>
</body>
</html>
