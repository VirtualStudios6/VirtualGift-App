<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Puntos - VirtualGift</title>

    <!-- ‚úÖ Estilos externos -->
    <link rel="stylesheet" href="css/inicio.css">
    <link rel="stylesheet" href="css/puntos.css">

    <!-- ‚úÖ Android App Mode -->
    <script defer src="js/app-mode.js"></script>

    <!-- Firebase -->
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script defer src="js/firebase-config.js"></script>

    <!-- ‚úÖ Utilidad para mantener app=android en URLs -->
    <script>
        function withAppFlag(url) {
            const isAndroidApp =
                document.documentElement.classList.contains("android-app") ||
                document.body.classList.contains("android-app");

            if (!isAndroidApp) return url;
            if (url.includes("app=android")) return url;

            const parts = url.split('#');
            const base = parts[0];
            const hash = parts[1] ? ('#' + parts[1]) : '';

            const fixed = base.includes("?") ? (base + "&app=android") : (base + "?app=android");
            return fixed + hash;
        }
    </script>

    <!-- ‚úÖ Estilos m√≠nimos offerwall (opcional, pero recomendado) -->
    <style>
        .offerwall-box{
            width: 100%;
            min-height: 700px;
            border-radius: 14px;
            overflow: hidden;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.06);
        }
        .offerwall-loading{
            padding: 18px;
            color: rgba(220,239,255,0.85);
            font-size: 14px;
        }
        .offerwall-note{
            margin-top: 10px;
            font-size: 12px;
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <!-- ============================================ -->
    <!-- HEADER -->
    <!-- ============================================ -->
    <header class="header">
        <div class="logo">
            <img src="images/logo-virtual-login.png" alt="Virtual Studios Logo" class="logo-image">
            <span class="logo-text">VIRTUAL<span class="logo-studios">GIFT</span></span>
        </div>

        <div class="header-icons">
            <!-- Icono de usuario/perfil -->
            <div class="icon-users" onclick="window.location.href=withAppFlag('home.html')" style="cursor: pointer;">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
            </div>

            <!-- Icono de puntos/moneda -->
            <div class="icon-coin" onclick="window.location.href=withAppFlag('puntos.html')" style="cursor: pointer;">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="48" fill="#FDB813"/>
                    <defs>
                        <radialGradient id="coinGradient">
                            <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#FFA500;stop-opacity:1" />
                        </radialGradient>
                    </defs>
                    <circle cx="50" cy="50" r="42" fill="url(#coinGradient)"/>
                    <path d="M 30 30 L 42 65 L 50 65 L 58 65 L 70 30 L 62 30 L 54 57 L 50 57 L 46 57 L 38 30 Z" fill="#FFFACD"/>
                </svg>
            </div>

            <!-- Icono de notificaciones -->
            <div class="icon-notification" onclick="window.location.href=withAppFlag('notificaciones.html')" style="cursor: pointer;">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
                </svg>
                <span class="notification-badge" id="notificationBadge" style="display:none;">0</span>
            </div>
        </div>
    </header>

    <!-- ============================================ -->
    <!-- CONTENEDOR DE PUNTOS -->
    <!-- ============================================ -->
    <div class="points-container">

        <!-- Bot√≥n para volver -->
        <button class="back-button" onclick="window.location.href=withAppFlag('inicio.html')">
            ‚Üê Volver al inicio
        </button>

        <!-- ============================================ -->
        <!-- HEADER DE PUNTOS -->
        <!-- ============================================ -->
        <div class="points-header">
            <div class="points-icon">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="48" fill="#FDB813"/>
                    <defs>
                        <radialGradient id="coinGradient2">
                            <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#FFA500;stop-opacity:1" />
                        </radialGradient>
                    </defs>
                    <circle cx="50" cy="50" r="42" fill="url(#coinGradient2)"/>
                    <path d="M 30 30 L 42 65 L 50 65 L 58 65 L 70 30 L 62 30 L 54 57 L 50 57 L 46 57 L 38 30 Z" fill="#FFFACD"/>
                </svg>
            </div>
            <div class="points-label">Tus VirtualCoins</div>
            <div class="points-balance" id="totalPoints">0</div>
            <div class="points-conversion">‚âà $<span id="dollarValue">0.00</span> USD</div>
        </div>

        <!-- ============================================ -->
        <!-- SECCI√ìN: GANAR PUNTOS -->
        <!-- ============================================ -->
        <div class="section-header">
            <h2 class="section-title">üí∞ Ganar Puntos</h2>
        </div>

        <div class="points-grid">
            <div class="points-card">
                <div class="card-icon">üéÆ</div>
                <div class="card-title">Jugar Juegos</div>
                <div class="card-description">
                    Gana hasta 50 puntos por cada juego que completes en la secci√≥n de juegos populares.
                </div>
                <button class="card-action" onclick="window.location.href=withAppFlag('inicio.html#games')">
                    Jugar Ahora
                </button>
            </div>

            <div class="points-card">
                <div class="card-icon">üéÅ</div>
                <div class="card-title">Recompensa Diaria</div>
                <div class="card-description">
                    Inicia sesi√≥n diariamente y recibe 250 puntos gratis cada d√≠a.
                </div>
                <button class="card-action btn-primary" id="dailyRewardBtn">Reclamar Hoy</button>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- ‚úÖ NUEVA SECCI√ìN: OFERTAS AYETSTUDIOS -->
        <!-- ============================================ -->
        <div class="section-header" style="margin-top: 30px;">
            <h2 class="section-title">üß© Ofertas (Gana m√°s puntos)</h2>
            <span class="exchange-rate">Completa ofertas y gana VirtualCoins autom√°ticamente</span>
        </div>

        <div class="offerwall-box" id="offerwall-container">
            <div class="offerwall-loading">
                Cargando ofertas...
                <div class="offerwall-note">
                    Si no aparece nada, revisa tu conexi√≥n o desactiva AdBlock/VPN.
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- SECCI√ìN: CANJEAR PUNTOS -->
        <!-- ============================================ -->
        <div class="section-header" style="margin-top: 30px;">
            <h2 class="section-title">üéØ Canjear Puntos</h2>
            <span class="exchange-rate">100 puntos = $1 USD</span>
        </div>

        <div class="redeem-grid">
            <!-- PayPal - ACTIVO -->
            <div class="redeem-card redeem-active">
                <div class="redeem-badge">Disponible</div>
                <div class="redeem-icon">
                    <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20.067 8.478c.492.88.556 2.014.3 3.327-.74 3.806-3.276 5.12-6.514 5.12h-.5a.805.805 0 0 0-.794.68l-.04.22-.63 3.993-.028.15a.805.805 0 0 1-.794.679H7.72a.483.483 0 0 1-.477-.558L9.33 7.025a.972.972 0 0 1 .958-.825h4.122c1.334 0 2.525.234 3.485.702.88.43 1.528 1.053 1.943 1.834.123.232.226.48.308.742z"/>
                        <path d="M10.502 8.309a.93.93 0 0 1 .917-.792h5.665c.677 0 1.304.05 1.872.156.12.022.237.046.35.073.25.06.484.13.704.21.226.083.44.175.64.279.588.303 1.058.68 1.401 1.132.206-.037.4-.08.58-.13.935-.259 1.62-.75 2.04-1.477.39-.675.522-1.523.382-2.496C24.522 3.55 23.182 2.5 21.155 2.5H14.02c-.565 0-1.046.39-1.172.925l-2.346 11.884z"/>
                    </svg>
                </div>
                <div class="redeem-title">PayPal</div>
                <div class="redeem-description">
                    Recibe dinero directo en tu cuenta PayPal. M√≠nimo 100 puntos.
                </div>
                <div class="redeem-min">M√≠nimo: 100 puntos</div>
                <button class="redeem-action" id="redeemPaypalBtn">
                    Canjear Ahora
                </button>
            </div>

            <!-- Amazon - BLOQUEADO -->
            <div class="redeem-card redeem-locked">
                <div class="redeem-badge redeem-badge-locked">Pr√≥ximamente</div>
                <div class="redeem-icon">
                    <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M.045 18.02c.072-.116.187-.124.348-.022 3.636 2.11 7.594 3.166 11.87 3.166 2.852 0 5.668-.533 8.447-1.595l.315-.14c.138-.06.234-.1.293-.13.226-.088.39-.046.525.13.12.174.09.336-.12.48-.256.19-.6.41-1.006.654-1.244.73-2.575 1.297-3.99 1.7-1.416.403-2.92.605-4.516.605-2.17 0-4.312-.427-6.427-1.28-2.116-.854-3.972-2.093-5.568-3.716-.1-.11-.15-.235-.15-.375-.002-.09.025-.154.08-.197zm13.206-8.954c-.362-.624-.633-.998-.813-1.12-.18-.124-.57-.187-1.17-.187-.96 0-1.596.147-1.908.44-.312.294-.468.734-.468 1.32 0 .588.19 1.06.57 1.416.38.356.888.534 1.524.534.71 0 1.35-.24 1.92-.72.57-.48.855-1.063.855-1.75 0-.214-.17-.427-.51-.64zm3.045 3.132c-.12-.096-.226-.096-.315 0-.088.096-.09.19-.006.285.93 1.04 1.395 2.092 1.395 3.155 0 1.063-.365 1.97-1.095 2.72-.73.75-1.65 1.125-2.76 1.125-.96 0-1.83-.3-2.61-.9-.39-.294-.696-.69-.918-1.188-.222-.498-.333-1.042-.333-1.632 0-.924.27-1.71.81-2.358.54-.648 1.242-.972 2.106-.972.6 0 1.11.144 1.53.432.42.288.63.66.63 1.116 0 .33-.105.603-.315.82-.21.217-.495.326-.855.326-.24 0-.435-.06-.585-.18-.15-.12-.225-.285-.225-.495 0-.144.045-.27.135-.378.09-.108.195-.162.315-.162.09 0 .165.03.225.09.06.06.09.138.09.234 0 .072-.015.132-.045.18s-.075.084-.135.108c-.06.024-.09.048-.09.072 0 .06.075.126.225.198.15.072.315.108.495.108.324 0 .585-.12.783-.36.198-.24.297-.54.297-.9 0-.576-.225-1.056-.675-1.44-.45-.384-1.02-.576-1.71-.576-1.08 0-1.962.375-2.646 1.125-.684.75-1.026 1.68-1.026 2.79 0 1.11.36 2.04 1.08 2.79.72.75 1.62 1.125 2.7 1.125 1.26 0 2.31-.435 3.15-1.305.84-.87 1.26-1.95 1.26-3.24-.001-1.29-.466-2.43-1.396-3.42zm7.554 4.578c-.12.096-.27.144-.45.144-.18 0-.33-.048-.45-.144a.47.47 0 0 1-.18-.378c0-.144.06-.27.18-.378.12-.108.27-.162.45-.162.18 0 .33.054.45.162.12.108.18.234.18.378a.47.47 0 0 1-.18.378z"/>
                    </svg>
                </div>
                <div class="redeem-title">Amazon Gift Card</div>
                <div class="redeem-description">
                    Tarjetas de regalo de Amazon para tus compras favoritas.
                </div>
                <div class="redeem-min">Pr√≥ximamente</div>
                <button class="redeem-action" disabled>
                    üîí Bloqueado
                </button>
            </div>

            <!-- Steam - BLOQUEADO -->
            <div class="redeem-card redeem-locked">
                <div class="redeem-badge redeem-badge-locked">Pr√≥ximamente</div>
                <div class="redeem-icon">
                    <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.979 0C5.678 0 .511 4.86.022 11.037l6.432 2.658c.545-.371 1.203-.59 1.912-.59.063 0 .125.004.188.006l2.861-4.142V8.91c0-2.495 2.028-4.524 4.524-4.524 2.494 0 4.524 2.031 4.524 4.527s-2.03 4.525-4.524 4.525h-.105l-4.076 2.911c0 .052.004.105.004.159 0 1.875-1.515 3.396-3.39 3.396-1.635 0-3.016-1.173-3.331-2.727L.436 15.27C1.862 20.307 6.486 24 11.979 24c6.627 0 11.999-5.373 11.999-12S18.605 0 11.979 0zM7.54 18.21l-1.473-.61c.262.543.714.999 1.314 1.25 1.297.539 2.793-.076 3.332-1.375.263-.63.264-1.319.005-1.949s-.75-1.121-1.377-1.383c-.624-.26-1.29-.249-1.878-.03l1.523.63c.956.4 1.409 1.5 1.009 2.455-.397.957-1.497 1.41-2.454 1.012H7.54zm11.415-9.303c0-1.662-1.353-3.015-3.015-3.015-1.665 0-3.015 1.353-3.015 3.015 0 1.665 1.35 3.015 3.015 3.015 1.663 0 3.015-1.35 3.015-3.015zm-5.273-.005c0-1.252 1.013-2.266 2.265-2.266 1.249 0 2.266 1.014 2.266 2.266 0 1.251-1.017 2.265-2.266 2.265-1.253 0-2.265-1.014-2.265-2.265z"/>
                    </svg>
                </div>
                <div class="redeem-title">Steam Wallet</div>
                <div class="redeem-description">
                    Cr√©dito para tu cuenta de Steam y compra tus juegos favoritos.
                </div>
                <div class="redeem-min">Pr√≥ximamente</div>
                <button class="redeem-action" disabled>
                    üîí Bloqueado
                </button>
            </div>

            <!-- Google Play - BLOQUEADO -->
            <div class="redeem-card redeem-locked">
                <div class="redeem-badge redeem-badge-locked">Pr√≥ximamente</div>
                <div class="redeem-icon">
                    <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1.22 0c-.03.093-.04.295-.02.483L12.707 12 1.2 23.517c-.02.188-.01.39.02.483.053.168.158.295.29.39l11.602-11.89L1.51.61C1.378.705 1.273.832 1.22 0zM14.91 10.205L3.32.295c-.148-.113-.323-.185-.508-.205L13.83 11.105l1.08-0.9zM22.59 10.885c.315.177.503.43.562.704.01.042.01.085.01.128 0 .043 0 .086-.01.128-.06.275-.247.527-.562.704l-2.832 1.587-1.508-1.262 1.508-1.262 2.832 1.587zM12.812 12.895l1.018 1.018 1.08 0.9-11.018 9.99c-.185-.02-.36-.092-.508-.205L14.91 13.795l-2.098-0.9z"/>
                    </svg>
                </div>
                <div class="redeem-title">Google Play</div>
                <div class="redeem-description">
                    Tarjetas de Google Play para apps, juegos y contenido digital.
                </div>
                <div class="redeem-min">Pr√≥ximamente</div>
                <button class="redeem-action" disabled>
                    üîí Bloqueado
                </button>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- MODAL DE CANJE PAYPAL -->
    <!-- ============================================ -->
    <div id="paypalModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üí∞ Canjear por PayPal</h3>
                <button class="modal-close" id="closeModalBtn">‚úï</button>
            </div>

            <div class="modal-body">
                <div class="modal-info">
                    <div class="info-item">
                        <span class="info-label">Tus puntos:</span>
                        <span class="info-value" id="modalPoints">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Tasa de cambio:</span>
                        <span class="info-value">100 puntos = $1 USD</span>
                    </div>
                </div>

                <form id="paypalForm" class="redeem-form">
                    <div class="form-group">
                        <label class="form-label">Nombre Completo</label>
                        <input
                            type="text"
                            id="fullName"
                            class="form-input"
                            placeholder="Ej: Juan P√©rez"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label class="form-label">Correo PayPal</label>
                        <input
                            type="email"
                            id="paypalEmail"
                            class="form-input"
                            placeholder="tu-email@ejemplo.com"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label class="form-label">Puntos a Canjear (M√≠nimo: 100)</label>
                        <input
                            type="number"
                            id="pointsAmount"
                            class="form-input"
                            placeholder="100"
                            min="100"
                            step="100"
                            required
                        />
                        <div class="form-helper">
                            Recibir√°s: $<span id="usdAmount">0.00</span> USD
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="cancelBtn">
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary" id="confirmRedeemBtn">
                            Confirmar Canje
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ‚úÖ Scripts externos -->
    <script defer src="js/puntos.js"></script>

    <!-- ‚úÖ Ayet Offerwall (integraci√≥n directa aqu√≠) -->
    <script>
      (function initAyetOfferwall() {
        // Espera a que Firebase est√© listo (firebase-config.js robusto expone waitForFirebase)
        function start() {
          try {
            if (!window.firebase || !firebase.auth) return;

            firebase.auth().onAuthStateChanged(function(user) {
              const container = document.getElementById("offerwall-container");
              if (!container) return;

              if (!user) {
                container.innerHTML = '<div class="offerwall-loading">Inicia sesi√≥n para ver las ofertas.</div>';
                return;
              }

              // ‚ö†Ô∏è CAMBIA ESTO por tu Publisher ID real de Ayet
              const publisherId = "PUBLISHER_ID_AQUI";

              const iframe = document.createElement("iframe");
              iframe.src = `https://wall.ayetstudios.com/?publisher_id=${publisherId}&user_id=${encodeURIComponent(user.uid)}`;
              iframe.width = "100%";
              iframe.height = "700";
              iframe.style.border = "0";
              iframe.loading = "lazy";

              container.innerHTML = "";
              container.appendChild(iframe);
            });
          } catch (e) {
            const container = document.getElementById("offerwall-container");
            if (container) {
              container.innerHTML = '<div class="offerwall-loading">No se pudieron cargar las ofertas.</div>';
            }
          }
        }

        if (typeof window.waitForFirebase === "function") {
          window.waitForFirebase(start);
        } else {
          // Fallback simple
          window.addEventListener("load", start);
        }
      })();
    </script>
</body>
</html>
